# ุฅุตูุงุญ ุฎุทุฃ ุงูุชุฐุงูุฑ ุงูุทุงุฑุฆุฉ - Emergency Ticket Fix

## ุงููุดููุฉ
ูุงู ูุธูุฑ ุฎุทุฃ `TypeError: 'notes' is an invalid keyword argument for Ticket` ุนูุฏ ูุญุงููุฉ ุฅูุดุงุก ุชุฐูุฑุฉ ุทุงุฑุฆุฉ.

## ุงูุณุจุจ
ูููุฐุฌ `Ticket` ูู ููู `models.py` ูู ููู ูุญุชูู ุนูู ุญูู `notes`ุ ุจูููุง ูุงู ุงูููุฏ ูุญุงูู ุชูุฑูุฑ ูุฐุง ุงููุนุงูู ุนูุฏ ุฅูุดุงุก ุชุฐูุฑุฉ ุทุงุฑุฆุฉ.

## ุงูุญู ุงููุทุจู

### 1. ุชุญุฏูุซ ูููุฐุฌ Ticket
ุชู ุฅุถุงูุฉ ุญูู `notes` ุฅูู ูููุฐุฌ `Ticket` ูู ููู `clinic_app/models.py`:

```python
class Ticket(db.Model):
    # ... ุงูุญููู ุงูููุฌูุฏุฉ
    notes = db.Column(db.Text, nullable=True)  # ููุงุญุธุงุช ุญูู ุงูุชุฐูุฑุฉ (ุฎุงุตุฉ ููุทูุงุฑุฆ)
```

### 2. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
ุชู ุฅูุดุงุก ูุชูููุฐ ููู `add_notes_to_ticket.py` ูุฅุถุงูุฉ ุงูุนููุฏ ุงูุฌุฏูุฏ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ:

```python
cursor.execute("ALTER TABLE ticket ADD COLUMN notes TEXT")
```

### 3. ุชุญุฏูุซ ูุธุงู ุงูุฃููููุฉ
ุชู ุชุญุณูู ูุธุงู ุงูุฃููููุฉ ูู ูููุฐุฌ Ticket:
- `priority = 0`: ุชุฐูุฑุฉ ุนุงุฏูุฉ
- `priority = 1`: ุชุฐูุฑุฉ ุญุฌุฒ (ููุนุฏ)
- `priority = 2`: ุชุฐูุฑุฉ ุทุงุฑุฆุฉ

### 4. Routes ุงูุชุฐุงูุฑ ุงูุทุงุฑุฆุฉ
ุชู ุงูุชุฃูุฏ ูู ูุฌูุฏ routes ุตุญูุญุฉ ููุชุฐุงูุฑ ุงูุทุงุฑุฆุฉ:
- `/emergency-ticket`: ุตูุญุฉ ุฅูุดุงุก ุชุฐูุฑุฉ ุทุงุฑุฆุฉ
- `/emergency-ticket/create/<patient_id>`: ุฅูุดุงุก ุชุฐูุฑุฉ ุทุงุฑุฆุฉ ููุฑูุถ ูุญุฏุฏ
- `/api/search-patients-emergency`: API ููุจุญุซ ุนู ุงููุฑุถู

### 5. ูุงุฌูุฉ ุงููุณุชุฎุฏู
ุชู ุงูุชุฃูุฏ ูู ูุฌูุฏ:
- ุฒุฑ "Ticket d'urgence" ูู dashboard ุงูุณูุฑุชูุฑ
- ุตูุญุฉ `emergency_ticket.html` ูุน ุชุตููู ูุฎุตุต ููุทูุงุฑุฆ
- ูุธุงู ุจุญุซ ุชููุงุฆู ูููุฑุถู

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### ูุธุงู ุงูุฃููููุฉ ุงููุญุณู
- ุงูุชุฐุงูุฑ ุงูุทุงุฑุฆุฉ ุชุญุตู ุนูู ุฃููููุฉ ูุทููุฉ (priority = 2)
- ูุชู ุนุฑุถูุง ูู ุงูููุฏูุฉ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ
- ุฅููุงููุฉ ุชุฑููุฉ ุงูุชุฐุงูุฑ ุงูุนุงุฏูุฉ ุฅูู ุทุงุฑุฆุฉ

### ููุงุญุธุงุช ุงูุชุฐุงูุฑ
- ุฅููุงููุฉ ุฅุถุงูุฉ ููุงุญุธุงุช ููุชุฐุงูุฑ ุงูุทุงุฑุฆุฉ
- ุญูุธ ุณุจุจ ุงูุทูุงุฑุฆ ุฃู ุชูุงุตูู ุฅุถุงููุฉ
- ุนุฑุถ ุงูููุงุญุธุงุช ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ

### ูุงุฌูุฉ ูุณุชุฎุฏู ูุญุณูุฉ
- ุชุตููู ูุฎุตุต ููุชุฐุงูุฑ ุงูุทุงุฑุฆุฉ ุจุฃููุงู ุชุญุฐูุฑูุฉ
- ุฅุญุตุงุฆูุงุช ููููุฉ ููุชุฐุงูุฑ ุงูุทุงุฑุฆุฉ
- ุชุนูููุงุช ูุงุถุญุฉ ููุงุณุชุฎุฏุงู ุงููุณุคูู

## ุงููููุงุช ุงููุญุฏุซุฉ
1. `clinic_app/models.py` - ุฅุถุงูุฉ ุญูู notes
2. `clinic_app/secretary/routes.py` - routes ุงูุชุฐุงูุฑ ุงูุทุงุฑุฆุฉ
3. `clinic_app/templates/secretary/emergency_ticket.html` - ูุงุฌูุฉ ุงูุชุฐุงูุฑ ุงูุทุงุฑุฆุฉ
4. `clinic_app/templates/secretary/dashboard_improved.html` - ุฒุฑ ุงูุชุฐุงูุฑ ุงูุทุงุฑุฆุฉ

## ุงููููุงุช ุงูุฌุฏูุฏุฉ
1. `add_notes_to_ticket.py` - ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. `update_existing_tickets.py` - ุชุญุฏูุซ ุงูุชุฐุงูุฑ ุงูููุฌูุฏุฉ
3. `EMERGENCY_TICKET_FIX.md` - ูุฐุง ุงูููู

## ุงูุชุญูู ูู ุงูุญู
โ ุชู ุฅุถุงูุฉ ุญูู notes ุฅูู ูููุฐุฌ Ticket
โ ุชู ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ
โ ุชู ุชุดุบูู ุงูุชุทุจูู ุจุฏูู ุฃุฎุทุงุก
โ ุฒุฑ ุงูุชุฐุงูุฑ ุงูุทุงุฑุฆุฉ ูุชุงุญ ูู dashboard
โ ูุธุงู ุงูุฃููููุฉ ูุนูู ุจุดูู ุตุญูุญ

## ุงูุงุณุชุฎุฏุงู
1. ูู dashboard ุงูุณูุฑุชูุฑุ ุงุถุบุท ุนูู "Ticket d'urgence"
2. ุงุจุญุซ ุนู ุงููุฑูุถ ุจุงูุงุณู ุฃู ุฑูู ุงููุงุชู
3. ุฃุถู ููุงุญุธุงุช ุฅุฐุง ูุฒู ุงูุฃูุฑ
4. ุงุถุบุท "ุฅูุดุงุก ุชุฐูุฑุฉ ุงูุทูุงุฑุฆ"
5. ุณุชุธูุฑ ุงูุชุฐูุฑุฉ ูู ุงูููุฏูุฉ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ

## ููุงุญุธุงุช ูููุฉ
- ุงูุชุฐุงูุฑ ุงูุทุงุฑุฆุฉ ูุฎุตุตุฉ ููุญุงูุงุช ุงูุทุจูุฉ ุงูุญููููุฉ ููุท
- ูุง ูููู ุฅูุดุงุก ุฃูุซุฑ ูู ุชุฐูุฑุฉ ุทุงุฑุฆุฉ ูุงุญุฏุฉ ูููุฑูุถ ูู ุงูููู ุงููุงุญุฏ
- ูููู ุชุฑููุฉ ุงูุชุฐุงูุฑ ุงูุนุงุฏูุฉ ุฅูู ุทุงุฑุฆุฉ ุฅุฐุง ูุฒู ุงูุฃูุฑ
- ุงููุธุงู ูุญุงูุธ ุนูู ุชุฑุชูุจ ุงูุฃููููุฉ: ุทุงุฑุฆุฉ > ุญุฌุฒ > ุนุงุฏูุฉ

ุชู ุฅุตูุงุญ ุงููุดููุฉ ุจูุฌุงุญ! ๐