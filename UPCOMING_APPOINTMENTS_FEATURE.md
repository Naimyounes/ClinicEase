# ميزة مواعيد الأيام القادمة والإشعارات - ClinicEase

## نظرة عامة
تم إضافة نظام شامل لإدارة مواعيد الأيام القادمة مع نظام إشعارات ذكي للسكرتيرة للاتصال المسبق بالمرضى.

## الميزات الجديدة

### 1. صفحة مواعيد الأيام القادمة
- **عرض مواعيد 3 أيام**: اليوم، الغد، وبعد الغد
- **تنظيم واضح**: كل يوم في قسم منفصل مع ألوان مميزة
- **معلومات شاملة**: اسم المريض، رقم الهاتف، الطبيب، الوقت
- **حالة الاتصال**: تتبع ما إذا تم الاتصال بالمريض أم لا

### 2. نظام تسجيل الاتصالات
- **زر "تم الاتصال"**: لتسجيل الاتصال بالمريض
- **تسجيل تلقائي**: إضافة ملاحظة بتاريخ ووقت الاتصال
- **تمييز بصري**: تلوين الصفوف للمواعيد التي تم الاتصال بها
- **منع التكرار**: عدم إظهار زر الاتصال بعد تسجيله

### 3. نظام الإشعارات الذكي
- **إشعارات في لوحة التحكم**: تنبيهات بارزة للمواعيد التي تحتاج اتصال
- **تصنيف الأولوية**: 
  - مواعيد اليوم: إشعار عاجل (أحمر)
  - مواعيد الغد: إشعار مهم (أصفر)
- **عداد المواعيد**: عرض عدد المواعيد التي لم يتم الاتصال بها
- **رابط مباشر**: انتقال سريع لصفحة المواعيد

### 4. إحصائيات المواعيد
- **بطاقات إحصائية**: عرض عدد مواعيد كل يوم
- **حالة الاتصال**: إظهار عدد المواعيد التي لم يتم الاتصال بها
- **تحديث فوري**: تحديث الإحصائيات عند تسجيل الاتصالات

## واجهة المستخدم

### 1. صفحة مواعيد الأيام القادمة
- **تصميم منظم**: 3 أقسام منفصلة لكل يوم
- **ألوان مميزة**:
  - اليوم: أصفر (تحذيري)
  - الغد: أزرق (معلوماتي)
  - بعد الغد: رمادي (ثانوي)
- **أزرار الاتصال**: روابط مباشرة لأرقام الهواتف
- **طباعة**: إمكانية طباعة قائمة المواعيد

### 2. لوحة التحكم المحدثة
- **إشعارات بارزة**: تنبيهات في أعلى الصفحة
- **بطاقات إحصائية**: 3 بطاقات للأيام القادمة
- **زر سريع**: رابط مباشر مع عداد للمواعيد المعلقة

### 3. قائمة التنقل
- **رابط جديد**: "مواعيد للاتصال" في القائمة الرئيسية
- **سهولة الوصول**: وصول سريع من أي صفحة

## الوظائف التقنية

### 1. استعلامات قاعدة البيانات
```python
# مواعيد اليوم
today_appointments = Appointment.query.filter(
    db.func.date(Appointment.appointment_date) == today,
    Appointment.status == "مجدول"
).order_by(Appointment.appointment_date.asc()).all()

# تحديد المواعيد التي لم يتم الاتصال بها
today_not_contacted = [apt for apt in today_appointments 
                      if not apt.notes or 'تم الاتصال' not in apt.notes]
```

### 2. تسجيل الاتصالات
```python
# إضافة ملاحظة الاتصال
contact_note = f"تم الاتصال بالمريض في {datetime.now().strftime('%Y-%m-%d %H:%M')}"
if appointment.notes:
    appointment.notes += f"\n{contact_note}"
else:
    appointment.notes = contact_note
```

### 3. نظام الإشعارات
- **شروط الإظهار**: إظهار الإشعار فقط عند وجود مواعيد لم يتم الاتصال بها
- **تحديث تلقائي**: تحديث الصفحة كل 5 دقائق
- **إخفاء الإشعار**: إمكانية إخفاء الإشعار مؤقتاً

## الملفات المضافة/المحدثة

### ملفات جديدة
- `secretary/upcoming_appointments.html` - صفحة مواعيد الأيام القادمة

### ملفات محدثة
- `secretary/routes.py` - إضافة routes جديدة
- `secretary/dashboard.html` - إضافة إشعارات وإحصائيات
- `layout.html` - إضافة رابط في قائمة التنقل

### Routes جديدة
- `/upcoming_appointments` - عرض مواعيد الأيام القادمة
- `/appointment/<id>/mark_contacted` - تسجيل الاتصال بالمريض

## سير العمل

### للسكرتيرة
1. **فتح لوحة التحكم** - رؤية الإشعارات والإحصائيات
2. **النقر على "مواعيد للاتصال"** - الانتقال لصفحة المواعيد
3. **مراجعة مواعيد اليوم** - البدء بالمواعيد العاجلة
4. **الاتصال بالمرضى** - استخدام أرقام الهواتف المعروضة
5. **تسجيل الاتصال** - النقر على "تم الاتصال" بعد كل مكالمة
6. **متابعة مواعيد الغد** - الاتصال المسبق للتذكير
7. **مراجعة بعد الغد** - التخطيط المسبق

### مزايا النظام
- **تنظيم أفضل**: عدم نسيان أي موعد
- **خدمة محسنة**: تذكير المرضى مسبقاً
- **تقليل الغياب**: اتصال مسبق يقلل عدم الحضور
- **متابعة دقيقة**: تسجيل جميع الاتصالات

## الإشعارات والتنبيهات

### 1. إشعارات لوحة التحكم
- **إشعار عاجل**: للمواعيد اليوم (أحمر)
- **إشعار مهم**: للمواعيد الغد (أصفر)
- **عداد المواعيد**: عدد المواعيد المعلقة
- **رابط مباشر**: انتقال فوري للصفحة

### 2. مؤشرات بصرية
- **ألوان الصفوف**: أخضر للمتصل بهم، أصفر للمعلقين
- **شارات العداد**: عدد المواعيد على الأزرار
- **أيقونات واضحة**: رموز مميزة لكل نوع موعد

### 3. تحديث تلقائي
- **تحديث الصفحة**: كل 5 دقائق للحصول على آخر البيانات
- **تحديث الإحصائيات**: فوري عند تسجيل الاتصالات
- **تحديث الإشعارات**: اختفاء تلقائي عند إنجاز المهام

## الفوائد

### للعيادة
- **تحسين الخدمة**: تذكير مسبق للمرضى
- **تقليل الغياب**: انخفاض عدد المواعيد الفائتة
- **تنظيم أفضل**: جدولة واضحة ومنظمة
- **متابعة دقيقة**: تسجيل جميع التفاعلات

### للمرضى
- **تذكير مفيد**: عدم نسيان المواعيد
- **خدمة أفضل**: اتصال مهذب ومنظم
- **مرونة أكبر**: إمكانية إعادة الجدولة مسبقاً
- **ثقة أعلى**: شعور بالاهتمام والمتابعة

### للسكرتيرة
- **مهام واضحة**: قائمة محددة للاتصالات
- **تنظيم يومي**: خطة عمل واضحة
- **تتبع دقيق**: معرفة ما تم إنجازه
- **كفاءة أعلى**: عدم تكرار الاتصالات

## التحسينات المستقبلية المقترحة

1. **رسائل SMS تلقائية**: إرسال تذكيرات نصية
2. **قوالب رسائل**: رسائل جاهزة للاتصالات
3. **تقارير الاتصالات**: إحصائيات شهرية
4. **تذكيرات صوتية**: تنبيهات صوتية للمواعيد العاجلة
5. **تكامل مع التقويم**: مزامنة مع تقويم Google
6. **إشعارات الموبايل**: تطبيق موبايل للإشعارات

---

**تاريخ التحديث**: 30 يوليو 2025  
**الإصدار**: 2.1  
**المطور**: فريق ClinicEase