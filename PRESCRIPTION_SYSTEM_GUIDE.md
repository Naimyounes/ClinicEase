# دليل نظام الوصفات الطبية المحدث

## نظرة عامة
تم تحديث نظام الوصفات الطبية في ClinicEase ليشمل ميزات جديدة ومحسنة لإدارة الوصفات الطبية بشكل أكثر فعالية.

## الميزات الجديدة

### 1. حقل الكمية/المدة
- **الوصف**: إضافة حقل جديد لتحديد كمية الدواء أو مدة العلاج
- **الاستخدام**: يمكن إدخال معلومات مثل "علبة واحدة"، "7 أيام"، "30 حبة"
- **الموقع**: في نموذج إنشاء الوصفة الطبية

### 2. تصميم الوصفة المطبوعة المحسن
- **التحسينات**:
  - تصميم يشبه الوصفات الطبية الحقيقية
  - جدول منظم للأدوية مع الكمية والتعليمات
  - معلومات المريض في تنسيق احترافي
  - توقيع الطبيب وتاريخ الإصدار

### 3. عرض وإدارة الوصفات
- **عرض الوصفة**: زر لعرض تفاصيل الوصفة في صفحة منفصلة
- **إعادة الطباعة**: إمكانية إعادة طباعة الوصفة في أي وقت
- **الحفظ التلقائي**: حفظ الوصفة كملف PDF تلقائياً

## كيفية الاستخدام

### إنشاء وصفة طبية جديدة

1. **الدخول إلى صفحة الزيارة**
   - اذهب إلى لوحة تحكم الطبيب
   - اختر المريض وابدأ الزيارة

2. **إنشاء الوصفة**
   - في صفحة الزيارة، انقر على "إضافة وصفة طبية"
   - املأ البيانات المطلوبة:
     - اختر الدواء من القائمة
     - أدخل الكمية/المدة (مثال: "علبة واحدة" أو "7 أيام")
     - أدخل التعليمات (مثال: "حبة كل 8 ساعات")

3. **إضافة أدوية متعددة**
   - انقر على "إضافة دواء" لإضافة المزيد من الأدوية
   - يمكن إزالة أي دواء بالنقر على "إزالة"

4. **الحفظ والطباعة**
   - انقر على "إنشاء الوصفة الطبية"
   - سيتم حفظ الوصفة وإنشاء ملف PDF تلقائياً

### عرض وطباعة الوصفات الموجودة

1. **في صفحة تفاصيل الزيارة**
   - ستجد قسم "الوصفات الطبية"
   - إذا كانت هناك وصفة، ستظهر الأزرار التالية:
     - **عرض الوصفة**: لعرض التفاصيل الكاملة
     - **طباعة**: لطباعة الوصفة أو حفظها كـ PDF

2. **في صفحة عرض الوصفة**
   - عرض جدول مفصل بجميع الأدوية
   - معلومات المريض والطبيب
   - تاريخ إصدار الوصفة
   - أزرار للطباعة والعودة

## تنسيق الوصفة المطبوعة

### العناصر المتضمنة:
1. **رأس الوصفة**: "ORDONNANCE" بتنسيق احترافي
2. **معلومات المريض**:
   - الاسم (Nom)
   - العمر (Age)
   - التاريخ (Date)
   - رقم الهاتف (Tel)

3. **جدول الأدوية**:
   - رقم تسلسلي
   - اسم الدواء
   - الكمية/المدة
   - التعليمات

4. **معلومات الطبيب**:
   - اسم الطبيب
   - خط للتوقيع

## الملفات المحدثة

### ملفات قاعدة البيانات:
- `update_prescription_db.py`: سكريبت تحديث قاعدة البيانات

### ملفات النماذج:
- `clinic_app/doctor/forms.py`: إضافة حقل الكمية
- `clinic_app/models.py`: تحديث نموذج PrescriptionMedication

### ملفات المعالجة:
- `clinic_app/doctor/routes.py`: routes جديدة للعرض والطباعة
- `clinic_app/doctor/utils.py`: دالة إنشاء PDF محسنة

### ملفات القوالب:
- `clinic_app/templates/doctor/create_prescription.html`: نموذج محسن
- `clinic_app/templates/doctor/view_visit.html`: أزرار جديدة
- `clinic_app/templates/doctor/view_prescription.html`: صفحة عرض جديدة

## استكشاف الأخطاء

### مشاكل شائعة وحلولها:

1. **خطأ في إنشاء PDF**
   - تأكد من وجود مجلد `clinic_app/static/prescriptions/`
   - تأكد من صلاحيات الكتابة

2. **حقل الكمية لا يظهر**
   - تأكد من تشغيل `update_prescription_db.py`
   - تحقق من تحديث قاعدة البيانات

3. **الوصفة لا تظهر في الزيارة**
   - تأكد من حفظ الوصفة بنجاح
   - تحقق من ربط الوصفة بالزيارة الصحيحة

## الاختبار

لاختبار النظام:
```bash
python test_prescription_system.py
```

## الدعم الفني

في حالة وجود مشاكل:
1. تحقق من ملفات السجل (logs)
2. تأكد من تحديث قاعدة البيانات
3. تحقق من صلاحيات الملفات والمجلدات

---

**ملاحظة**: تأكد من عمل نسخة احتياطية من قاعدة البيانات قبل تطبيق التحديثات.